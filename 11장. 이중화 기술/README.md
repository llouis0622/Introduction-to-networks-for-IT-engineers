# 11장. 이중화 기술

# 1. 이중화 기술 개요

## 1. SPoF(Single Point of Failure)

- 단일 장애점
- 단일 접점의 장애가 전체 서비스에 영향을 미치지 않도록 SPoF를 만들지 않아야 함

## 2. 이중화의 목적

- 인프라를 구성하는 각 요소가 복수 개 이상으로 인프라 구성
- 액티브-액티브 구성, 액티브-스탠바이 구성
- 폴트 톨러런스(Fault Tolerance, FT) : 특정 인프라의 장애 상황에서도 서비스는 가능하므로 서비스의 연속성 보장

# 2. LACP(Link Aggregation Control Protocol)

- 상호호환 가능한 연결 계층 표준화
- 링크 사용률 향상(Improved Utilization of Available Link)
- 향상된 장애 회복(Improved Resilience)
- 두 개 이상의 물리 인터페이스로 구성된 논리 인터페이스를 이용해 모든 물리 인터페이스를 액티브 상태로 사용
- 액티브-액티브 구조 : 논리 인터페이스의 대역폭을 서비스에 필요한 전체 트래픽 기준으로 서비스 트래픽 산정 불가능
- 물리 인터페이스 속도 동일

## 1. LACP 동작 방식

- LACPDU(LACP Data Unit) : LACP를 구성하기 위한 출발지 주소, 목적지 주소, 타입, 서브 타입, 버전 정보를 포함해 매초마다 주고받음
- 멀티캐스트 이용
- 목적지 주소 01:80:c2:00:00:02 ~ 01:80:c2:00:00:10 사용
- 액티브 모드 : LACPDU를 먼저 송신하고 상대방이 LACP로 구성 → LACP 구성
- 패시브 모드 : LACPDU를 송신하지 않지만 LACPDU를 수신 → 응답 후 LACP 구성

## 2. LACP와 PXE

- PXE(Pre-boot eXecution Environment) : 서버가 운영체제를 설치하기 전 단계, 본딩과 티밍같은 논리 인터페이스 설정 불가

# 3. 서버의 네트워크 이중화 설정(Windows, Linux)

- 윈도우 : 팀(Team), 티밍(Teaming)
- 리눅스 : 본드(Bond), 본딩(Bonding)

## 1. 리눅스 본딩 모드

- 모드 1 : 액티브-스탠바이
- 모드 4 : LACP

## 2. 윈도우 티밍 모드

- 스위치 독립(Switch Independent) 구성 : 액티브-스탠바이, 팀을 구성하는 멤버 인터페이스가 스위치의 구성에 독립적인 경우
- LACP : 액티브-액티브, 리눅스 서버의 모드 4와 동일한 구성

# 4. MC-LAG(Multi-Chassis Link Aggregation Group)

- 각 네트워크 카드별로 물리 MAC 주소를 따로 사용하지 않고 두 개의 물리 MAC 주소 중 하나를 Primary MAC 주소로 사용
- 서로 다른 스위치 간의 실제 MAC 주소 대신 가상 MAC 주소를 만들어 논리 인터페이스로 LACP 구성
- 단일 스위치로 LACP 구성해 대역폭 확장, 서로 다른 스위치로 구성해 장비 이중화로 가용성 확보 선택 가능

## 1. MC-LAG 동작 방식

- 피어(Peer) 장비 : MC-LAG을 구성하는 장비
- MC-LAG 도메인 : 두 Peer 장비를 하나의 논리 장비로 구성하기 위한 영역 ID
- 피어 링크 : MC-LAG을 구성하는 두 Peer 장비 간의 데이터 트래픽을 전송하는 인터링크
- 피어에 동일한 도메인 ID 설정
- 피어 간의 데이터 트래픽 전송을 위한 피어 링크 설정
- 피어 간의 제어 패킷 전송을 위해 피어끼리 통신 가능한 IP 설정

## 2. MC-LAG을 이용한 디자인

- 스위치를 물리적으로 이중화하면서 액티브-액티브 구성으로 연결 가능
- 루프 구조 삭제 → STP에 의한 차단 포트 없이 모든 포트 사용 가능
- 상, 하단을 모두 MC-LAG으로 구성

# 5. 게이트웨이 이중화

## 1. 게이트웨이 이중화란?

- FHRP(First Hop Redundancy Protocol)
- 두 라우터는 실제 IP 외에 추가로 가상 IP 주소와 가상 IP에 대한 MAC 주소를 동일하게 보유
- 그룹 내에서 우선순위가 높은 장비가 Active 상태로 유지 → ARP 요청 응답

## 2. FHRP

- 외부 네트워크와 통신하기 위해 사용되는 게이트웨이 장비를 두 대 이상의 장비로 구성할 수 있는 프로토콜
- 스탠바이 장비는 액티브 장비가 비정상임을 확인한 후 가상 IP 주소에 대한 액티브 역할 보유
- 가상 IP 주소의 MAC 주소에 대한 MAC 주소 테이블을 갱신해 하단 호스트들은 아무 설정 없이 절체 이루어짐
- VRRP(Virtual Router Redundancy Protocol) : 게이트웨이 이중화 기술로서 거의 모든 벤더 장비가 VRRP 기능 지원

## 3. 올 액티브 게이트웨이 이중화

- 게이트웨이 이중화 가상 IP의 MAC 주소를 액티브 장비와 스탠바이 장비에서 모두 사용할 수 있도록 해 게이트웨이를 액티브-액티브 형태로 구성하는 기능 제공

## 4. 애니캐스트 게이트웨이

- 각 위치에 같은 주소를 가지는 게이트웨이가 여러 개 동작
- 애니캐스트 사용
- 여러 개의 같은 IP를 가지는 게이트웨이 존재 → 가장 가까운 위치에 있는 게이트웨이에서 서비스 제공
